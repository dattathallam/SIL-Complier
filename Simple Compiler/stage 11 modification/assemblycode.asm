GETCOUNT:
PUSH BP
MOV BP,SP
PUSH R0
MOV R0 ,0
MOV R2,BP
MOV R1,1
ADD R2,R1
MOV [R2],R0
L0:
MOV R1,BP
MOV R2,2
SUB R1,R2
MOV R2,1
SUB R1,R2
MOV R0,[R1]
MOV R1 , 0
GT R0 , R1
JZ R0 , L1
MOV R1,BP
MOV R0,1
ADD R1,R0
MOV R0,[R1]
MOV R1 , 1
ADD R0 ,R1
MOV R2,BP
MOV R1,1
ADD R2,R1
MOV [R2],R0
MOV R1,BP
MOV R2,2
SUB R1,R2
MOV R2,1
SUB R1,R2
MOV R0,[R1]
MOV R1 , 15
SUB R0 ,R1
MOV R1,BP
MOV R2,2
SUB R1,R2
MOV R2,1
SUB R1,R2
MOV [R1],R0
JMP L0
L1:
MOV R1,BP
MOV R0,1
ADD R1,R0
MOV R0,[R1]
MOV R1,BP
MOV R2,2
SUB R1,R2
MOV [R1],R0
//OUT R0//////
POP R0
MOV BP,[SP]
POP R0
RET



ALLOCATION:
PUSH BP
MOV BP,SP
PUSH R0
PUSH R0
MOV R0, BP
MOV R1, 3
SUB R0, R1
MOV R0,[R0]
PUSH R0
PUSH R0
CALL GETCOUNT
POP R0
POP R0
MOV R0, SP
MOV R1, 2
ADD R0,R1
MOV R0,[R0]
//OUT R0////////////
//MOV R1,BP
//MOV R2,2
//SUB R1,R2
//MOV R2,1
//SUB R1,R2
//MOV R0,[R1]
MOV R2,BP
MOV R1,1
ADD R2,R1
MOV [R2],R0
//MOV R0 , 1
MOV R0 , [256]
MOV R2,BP
MOV R1,2
ADD R2,R1
MOV [R2],R0
L2:
MOV R1,BP
MOV R0,1
ADD R1,R0
MOV R0,[R1]
MOV R1 , 0
GT R0 , R1
JZ R0 , L3
MOV R1,BP
MOV R0,2
ADD R1,R0
MOV R0,[R1]
MOV R6,R0///////////
MOV R2, [R0]///
MOV [R1], R2
//OUT R2//////
MOV R1,BP
MOV R0,1
ADD R1,R0
MOV R0,[R1]
MOV R1 , 1
SUB R0 ,R1
MOV R2,BP
MOV R1,1
ADD R2,R1
MOV [R2],R0
JMP L2
L3:
MOV R1,BP
MOV R0,2
ADD R1, R0
MOV R0,[R1]
//OUT R0///48
MOV R5,16
MOV R7,R0
SUB R7,R5
MOV [R7],-1////critical
MOV R1, [256]
//OUT R1//0
MOV [256],R0
MOV R0, R1
MOV R1,BP
MOV R2,2
SUB R1,R2
MOV [R1],R0
//OUT R0//
POP R0
POP R0
MOV BP,[SP]
POP R0
RET

FREE1:
PUSH BP
MOV BP,SP
PUSH R0
PUSH R0
MOV R0, BP
MOV R1, 3
SUB R0, R1
MOV R5,[R0]
//OUT R5
MOV R1,BP
MOV R0,1
ADD R1,R0
MOV [R1],R5
//MOV R4,[96]
//OUT R4
//HALT
L4:
MOV R1,BP
MOV R0,1
ADD R1,R0
MOV R0,[R1]
//OUT R0
MOV R1 , -1
//MOV R2,[R0]
//OUT R2
NE R0,R1
//OUT R0 
JZ R0 , L5

MOV R1,BP
MOV R0,1
ADD R1,R0
MOV R0,[R1]
MOV R2,[R1]

MOV R2, [R2]

MOV R1,BP
MOV R0,1
ADD R1,R0
MOV [R1],R2


JMP L4
L5:

MOV R3,[256]

MOV R0, BP
MOV R1, 3
SUB R0, R1
MOV R0,[R0]
MOV [R0],R3

MOV R0, BP
MOV R1, 3
SUB R0, R1
MOV R4,[R0]
MOV [256],R4

//OUT R4//

MOV R1,BP
MOV R2,2
SUB R1,R2
MOV R5,-1
MOV [R1],R5

POP R0
POP R0
MOV BP,[SP]
POP R0
RET

START
MOV [0], -1
MOV [1], -1
MOV [2], -1
MOV [3], -1
MOV [4], -1
MOV [5], -1
MOV [6], -1
MOV [7], -1
MOV [8], -1
MOV [9], -1
MOV [10], -1
MOV [11], -1
MOV [12], -1
MOV [13], -1
MOV [14], -1
MOV [15], -1
MOV [16], -1
MOV [17], -1
MOV [18], -1
MOV [19], -1
MOV [20], -1
MOV [21], -1
MOV [22], -1
MOV [23], -1
MOV [24], -1
MOV [25], -1
MOV [26], -1
MOV [27], -1
MOV [28], -1
MOV [29], -1
MOV [30], -1
MOV [31], -1
MOV [32], -1
MOV [33], -1
MOV [34], -1
MOV [35], -1
MOV [36], -1
MOV [37], -1
MOV [38], -1
MOV [39], -1
MOV [40], -1
MOV [41], -1
MOV [42], -1
MOV [43], -1
MOV [44], -1
MOV [45], -1
MOV [46], -1
MOV [47], -1
MOV [48], -1
MOV [49], -1
MOV [50], -1
MOV [51], -1
MOV [52], -1
MOV [53], -1
MOV [54], -1
MOV [55], -1
MOV [56], -1
MOV [57], -1
MOV [58], -1
MOV [59], -1
MOV [60], -1
MOV [61], -1
MOV [62], -1
MOV [63], -1
MOV [64], -1
MOV [65], -1
MOV [66], -1
MOV [67], -1
MOV [68], -1
MOV [69], -1
MOV [70], -1
MOV [71], -1
MOV [72], -1
MOV [73], -1
MOV [74], -1
MOV [75], -1
MOV [76], -1
MOV [77], -1
MOV [78], -1
MOV [79], -1
MOV [80], -1
MOV [81], -1
MOV [82], -1
MOV [83], -1
MOV [84], -1
MOV [85], -1
MOV [86], -1
MOV [87], -1
MOV [88], -1
MOV [89], -1
MOV [90], -1
MOV [91], -1
MOV [92], -1
MOV [93], -1
MOV [94], -1
MOV [95], -1
MOV [96], -1
MOV [97], -1
MOV [98], -1
MOV [99], -1
MOV [100], -1
MOV [101], -1
MOV [102], -1
MOV [103], -1
MOV [104], -1
MOV [105], -1
MOV [106], -1
MOV [107], -1
MOV [108], -1
MOV [109], -1
MOV [110], -1
MOV [111], -1
MOV [112], -1
MOV [113], -1
MOV [114], -1
MOV [115], -1
MOV [116], -1
MOV [117], -1
MOV [118], -1
MOV [119], -1
MOV [120], -1
MOV [121], -1
MOV [122], -1
MOV [123], -1
MOV [124], -1
MOV [125], -1
MOV [126], -1
MOV [127], -1
MOV [128], -1
MOV [129], -1
MOV [130], -1
MOV [131], -1
MOV [132], -1
MOV [133], -1
MOV [134], -1
MOV [135], -1
MOV [136], -1
MOV [137], -1
MOV [138], -1
MOV [139], -1
MOV [140], -1
MOV [141], -1
MOV [142], -1
MOV [143], -1
MOV [144], -1
MOV [145], -1
MOV [146], -1
MOV [147], -1
MOV [148], -1
MOV [149], -1
MOV [150], -1
MOV [151], -1
MOV [152], -1
MOV [153], -1
MOV [154], -1
MOV [155], -1
MOV [156], -1
MOV [157], -1
MOV [158], -1
MOV [159], -1
MOV [160], -1
MOV [161], -1
MOV [162], -1
MOV [163], -1
MOV [164], -1
MOV [165], -1
MOV [166], -1
MOV [167], -1
MOV [168], -1
MOV [169], -1
MOV [170], -1
MOV [171], -1
MOV [172], -1
MOV [173], -1
MOV [174], -1
MOV [175], -1
MOV [176], -1
MOV [177], -1
MOV [178], -1
MOV [179], -1
MOV [180], -1
MOV [181], -1
MOV [182], -1
MOV [183], -1
MOV [184], -1
MOV [185], -1
MOV [186], -1
MOV [187], -1
MOV [188], -1
MOV [189], -1
MOV [190], -1
MOV [191], -1
MOV [192], -1
MOV [193], -1
MOV [194], -1
MOV [195], -1
MOV [196], -1
MOV [197], -1
MOV [198], -1
MOV [199], -1
MOV [200], -1
MOV [201], -1
MOV [202], -1
MOV [203], -1
MOV [204], -1
MOV [205], -1
MOV [206], -1
MOV [207], -1
MOV [208], -1
MOV [209], -1
MOV [210], -1
MOV [211], -1
MOV [212], -1
MOV [213], -1
MOV [214], -1
MOV [215], -1
MOV [216], -1
MOV [217], -1
MOV [218], -1
MOV [219], -1
MOV [220], -1
MOV [221], -1
MOV [222], -1
MOV [223], -1
MOV [224], -1
MOV [225], -1
MOV [226], -1
MOV [227], -1
MOV [228], -1
MOV [229], -1
MOV [230], -1
MOV [231], -1
MOV [232], -1
MOV [233], -1
MOV [234], -1
MOV [235], -1
MOV [236], -1
MOV [237], -1
MOV [238], -1
MOV [239], -1
MOV [240], -1
MOV [241], -1
MOV [242], -1
MOV [243], -1
MOV [244], -1
MOV [245], -1
MOV [246], -1
MOV [247], -1
MOV [248], -1
MOV [249], -1
MOV [250], -1
MOV [251], -1
MOV [252], -1
MOV [253], -1
MOV [254], -1
MOV [255], -1
MOV [0], 16
MOV [16], 32
MOV [32], 48
MOV [48], 64
MOV [64], 80
MOV [80], 96
MOV [96], 112
MOV [112], 128
MOV [128], 144
MOV [144], 160
MOV [160], 176
MOV [176], 192
MOV [192], 208
MOV [208], 224
MOV [224], 240
MOV [224], -1
MOV [256], 0
MOV SP,256
MOV BP,257
PUSH R0
CALL MAIN
HALT
MAIN:
PUSH BP
MOV BP,SP
PUSH R0
PUSH R0
PUSH R0
PUSH R0
PUSH R0
MOV R0 , 35
PUSH R0
PUSH R0
CALL ALLOCATION
POP R0
POP R0
MOV R0, 2
MOV R1, SP
ADD R1, R0
MOV R0, [R1]
MOV R2,BP
MOV R1,2
ADD R2,R1
MOV [R2],R0
MOV R0 , 25
PUSH R0
PUSH R0
CALL ALLOCATION
POP R0
POP R0
MOV R0, 2
MOV R1, SP
ADD R1, R0
MOV R0, [R1]
MOV R2,BP
MOV R1,3
ADD R2,R1
MOV [R2],R0
MOV R0 , 35
PUSH R0
PUSH R0
CALL ALLOCATION
POP R0
POP R0
MOV R0, 2
MOV R1, SP
ADD R1, R0
MOV R0, [R1]
MOV R2,BP
MOV R1,4
ADD R2,R1
MOV [R2],R0
PUSH R0
MOV R1,BP
MOV R0,3
ADD R1,R0
MOV R0,R1
MOV R1, [R0]
PUSH R1
PUSH R0
CALL FREE1
POP R0
MOV R1,BP
MOV R0,3
ADD R1,R0
MOV R0,R1
MOV [R0], R0
POP R0
POP R0
PUSH R0
MOV R0 , 35
PUSH R0
PUSH R0
CALL ALLOCATION
POP R0
POP R0
POP R0
MOV R1, 3
MOV R2, SP
ADD R2, R1
MOV R1, [R2]
MOV R3,BP
MOV R2,1
ADD R3,R2
MOV [R3],R1
PUSH R0
MOV R0 , 10
PUSH R0
PUSH R0
CALL ALLOCATION
POP R0
POP R0
POP R0
MOV R1, 3
MOV R2, SP
ADD R2, R1
MOV R1, [R2]
MOV R3,BP
MOV R2,5
ADD R3,R2
MOV [R3],R1
MOV R2,BP
MOV R1,2
ADD R2,R1
MOV R1,[R2]
OUT R1
MOV R2,BP
MOV R1,3
ADD R2,R1
MOV R1,[R2]
OUT R1
MOV R2,BP
MOV R1,4
ADD R2,R1
MOV R1,[R2]
OUT R1
MOV R2,BP
MOV R1,1
ADD R2,R1
MOV R1,[R2]
OUT R1
MOV R2,BP
MOV R1,5
ADD R2,R1
MOV R1,[R2]
OUT R1
PUSH R0
PUSH R1
MOV R1,BP
MOV R0,4
ADD R1,R0
MOV R0,R1
MOV R1, [R0]
PUSH R1
PUSH R0
CALL FREE1
POP R0
MOV R1,BP
MOV R0,4
ADD R1,R0
MOV R0,R1
MOV [R0], R0
POP R0
POP R1
POP R0
PUSH R0
PUSH R1
MOV R0 , 81
PUSH R0
PUSH R0
CALL ALLOCATION
POP R0
POP R0
POP R1
POP R0
MOV R2, 4
MOV R3, SP
ADD R3, R2
MOV R2, [R3]
MOV R4,BP
MOV R3,4
ADD R4,R3
MOV [R4],R2
MOV R3,BP
MOV R2,4
ADD R3,R2
MOV R2,[R3]
OUT R2
MOV R2 , 0
MOV R3,BP
MOV R4,2
SUB R3,R4
MOV [R3],R2
POP R0
POP R0
POP R0
POP R0
POP R0
MOV BP,[SP]
POP R0
RET
